<network>
    <name>{{ item.name }}</name>
    <forward mode='{{ item.mode }}'/>
    <domain name="{{ item.int_domain }}"/>
    <dns>
        <host ip='{{ subnet.split('.')[:3] | join('.')}}.2'>
            <hostname>bootstrap.{{ item.int_domain }}</hostname>
        </host>
        <host ip='{{ subnet.split('.')[:3] | join('.')}}.1'>
            <hostname>api-int.{{ item.public_domain }}</hostname>
            <hostname>api.{{ item.public_domain }}</hostname>
        </host>
        {% for id in range(0, item.count | int) -%}
        <srv service='etcd-server-ssl' protocol='tcp' domain='{{ item.public_domain }}' target='etcd-{{ id }}.{{ item.public_domain }}' port='2380' priority='0' weight='10'/>
        <host ip='{{ subnet.split('.')[:3] | join('.')}}.{{ 10 + id|int }}'>
            <hostname>master-{{ id }}.{{ item.int_domain }}</hostname>
            <hostname>etcd-{{ id }}.{{ item.public_domain }}</hostname>
        </host>
        {% endfor %}

    </dns>

    <ip address='{{ subnet.split('.')[:3] | join('.')}}.1' netmask='255.255.255.0'>
        <dhcp>
            <range start='{{ subnet.split('.')[:3] | join('.')}}.10' end='{{ subnet.split('.')[:3] | join('.')}}.250'/>
            <host mac='52:54:00:{{ '%02x' % subnet.split('.')[1]|int }}:{{ '%02x' % subnet.split('.')[2]|int }}:{{ '%02x' % 2 }}' name='bootstrap.{{ item.int_domain }}' ip='{{ subnet.split('.')[:3] | join('.')}}.2'/>
            {% for id in range(0, item.count | int) -%}
            <host mac='52:54:00:{{ '%02x' % subnet.split('.')[1]|int }}:{{ '%02x' % subnet.split('.')[2]|int }}:{{ '%02x' % (10 + id) }}' name='master-{{ id }}.{{ item.int_domain }}' ip='{{ subnet.split('.')[:3] | join('.')}}.{{ 10 + id }}'/>
            {% endfor -%}
            {% for id in range(0, vn_compute_count | int) -%}
            <host mac='52:54:00:{{ '%02x' % subnet.split('.')[1]|int }}:{{ '%02x' % subnet.split('.')[2]|int }}:{{ '%02x' % (10 + item.count|int + id) }}' name='compute-{{ id }}.{{ item.int_domain }}' ip='{{ subnet.split('.')[:3] | join('.')}}.{{ 10 + item.count|int + id }}'/>
            {% endfor %}

        </dhcp>
    </ip>
</network>
---
- name: Ensure libvirt bridge network is defined
  virt_net:
    name: "{{ item.name }}"
    command: define
    xml: '{{ (lookup("template", item.xml_file)) }}'
  with_items: "{{ libvirt_host_networks }}"
  when: item.mode == 'bridge' and item.create|bool
  become: True

- name: Ensure libvirt nat network is defined
  virt_net:
    name: "{{ item.name }}"
    command: define
    xml: '{{ (lookup("template", item.xml_file)) }}'
  with_items: "{{ libvirt_host_networks }}"
  when: item.mode == 'nat' and item.create|bool
  become: True

- name: Ensure libvirt networks are active
  virt_net:
    name: "{{ item.name }}"
    state: active
  with_items: "{{ libvirt_host_networks }}"
  become: True

- name: Ensure libvirt networks are started on boot
  virt_net:
    name: "{{ item.name }}"
    autostart: yes
  with_items: "{{ libvirt_host_networks }}"
  become: True

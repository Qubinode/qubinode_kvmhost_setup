---
- name: validate variables are defined
  import_tasks: verify_variables.yml

# Using the shell module because it appears to be faster
# than the yum or package module
- name: ensure required packages are installed
  shell: >
    rpm -q "{{ item }}" || yum install -y "{{ item }}" && echo yes
  args:
    warn: false
  loop: "{{ required_rpm_pakcages }}"
  register: pkg_installed
  changed_when: pkg_installed.stdout == 'yes'
  tags: [ install_packages ]

- name: configure shell extras
  import_tasks: configure_shell.yml
  when: configure_shell|bool

- name: Setup Libvirt
  import_tasks: libvirt_setup.yml

- name: Setup Cockpit
  import_tasks: cockpit_setup.yml
  when: enable_cockpit|bool

- name: update /etc/resolv.conf
  tags: [resolv]
  template:
    src: resolv.conf.j2
    dest: /etc/resolv.conf

